<!DOCTYPE html>
<html lang="<%= I18n.locale %>" class="h-100">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><%= content_for(:title) || t('oroshi.documentation.chrome.title') %></title>

  <%= capybara_lockstep if defined?(Capybara::Lockstep) %>

  <%= action_cable_meta_tag %>
  <%= turbo_refreshes_with method: :morph, scroll: :preserve %>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>

  <style>
    .doc-sidebar { width: 280px; min-height: calc(100vh - 56px); border-right: 1px solid #dee2e6; background: #f8f9fa; }
    .doc-sidebar .nav-link { padding: 0.35rem 1rem; font-size: 0.9rem; color: #495057; border-radius: 0; }
    .doc-sidebar .nav-link:hover { background: #e9ecef; color: #212529; }
    .doc-sidebar .nav-link.active { background: #0d6efd; color: #fff; font-weight: 500; }
    .doc-sidebar .nav-section { font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; color: #6c757d; padding: 0.75rem 1rem 0.25rem; margin-top: 0.5rem; }
    .doc-sidebar .nav-section:first-child { margin-top: 0; }
    .doc-content { max-width: 860px; }
    .doc-content h1 { font-size: 1.75rem; font-weight: 700; margin-bottom: 1rem; }
    .doc-content h2 { font-size: 1.35rem; font-weight: 600; margin-top: 2rem; margin-bottom: 0.75rem; padding-bottom: 0.35rem; border-bottom: 1px solid #dee2e6; }
    .doc-content h3 { font-size: 1.1rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
    .doc-screenshot { max-width: 100%; }
    .doc-screenshot img { max-width: 100%; }
    .doc-step-number { width: 32px; height: 32px; font-size: 0.85rem; font-weight: 700; }
    .doc-callout { border-left: 4px solid; }
    .doc-see-also { border-left: 3px solid #0d6efd; }
    .doc-search-input { border: 1px solid #ced4da; border-radius: 0.375rem; }
    .doc-search-results { max-height: 300px; overflow-y: auto; }
    .breadcrumb { font-size: 0.85rem; }
    @media (max-width: 991.98px) {
      .doc-sidebar { width: 100%; min-height: auto; border-right: none; border-bottom: 1px solid #dee2e6; }
    }
    @media print {
      .doc-sidebar, .doc-locale-toggle, nav#top_nav, footer { display: none !important; }
      .doc-content { max-width: 100%; padding: 0; }
    }
  </style>

  <%= yield :head %>
</head>
<body class="d-flex flex-column h-100">
  <%= render partial: "layouts/shared/navbar" %>

  <div class="d-flex flex-column flex-lg-row flex-grow-1">
    <%# Sidebar Navigation %>
    <aside class="doc-sidebar p-3" data-controller="documentation-search">
      <div class="mb-3">
        <%= doc_locale_toggle %>
      </div>

      <div class="mb-3">
        <input type="text"
               class="form-control form-control-sm doc-search-input"
               placeholder="<%= t('oroshi.documentation.chrome.search_placeholder') %>"
               data-documentation-search-target="input"
               data-action="input->documentation-search#search keydown->documentation-search#keydown">
        <div class="doc-search-results mt-1" data-documentation-search-target="results" style="display:none;"></div>
      </div>

      <nav>
        <div class="nav-section"><%= t('oroshi.documentation.chrome.home') %></div>
        <%= link_to t('oroshi.documentation.chrome.overview'),
              documentation_index_path(locale: I18n.locale),
              class: "nav-link #{'active' if @current_section.blank?}" %>

        <% @sections.each do |section_key, pages| %>
          <div class="nav-section"><%= t("oroshi.documentation.sections.#{section_key}") %></div>
          <%= link_to t("oroshi.documentation.sections.#{section_key}"),
                documentation_section_path(section: section_key, locale: I18n.locale),
                class: "nav-link fw-semibold #{'active' if @current_section == section_key.to_s && @current_page.blank?}" %>
          <% pages.each do |page_name| %>
            <%= link_to t("oroshi.documentation.pages.#{section_key}.#{page_name}"),
                  documentation_page_path(section: section_key, page: page_name, locale: I18n.locale),
                  class: "nav-link ps-4 #{'active' if @current_section == section_key.to_s && @current_page == page_name}" %>
          <% end %>
        <% end %>
      </nav>
    </aside>

    <%# Main Content %>
    <main class="flex-grow-1 p-4">
      <%# Breadcrumbs %>
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
          <% doc_breadcrumbs.each_with_index do |crumb, i| %>
            <% if crumb[:path] && i < doc_breadcrumbs.length - 1 %>
              <li class="breadcrumb-item"><%= link_to crumb[:label], crumb[:path] %></li>
            <% else %>
              <li class="breadcrumb-item active"><%= crumb[:label] %></li>
            <% end %>
          <% end %>
        </ol>
      </nav>

      <div class="doc-content">
        <%= yield %>
      </div>
    </main>
  </div>

  <%= render "layouts/shared/footer" %>
</body>
</html>
