# Ralph Progress Log
Started: Sun Jan 25 18:19:00 JST 2026
---

[2026-01-25 18:35:00] Story: US-001 Remove dual route files
Implemented: Removed dual route file pattern and adopted single engine route pattern
Files:
- config/routes_standalone_app.rb (deleted)
- config/routes_oroshi_engine.rb (deleted)
- config/routes.rb (updated comments)
- oroshi.gemspec (simplified, removed file exclusions)
Tests: PASSING (engine routes load correctly with 261 routes, model tests pass)
Learnings for future iterations:
- Oroshi uses single route file pattern: config/routes.rb with Oroshi::Engine.routes.draw
- Parent apps mount with: mount Oroshi::Engine, at: "/oroshi"
- sandbox script already generates its own routes.rb that mounts the engine
- gemspec no longer needs to exclude any config files
- Engine route helpers work without prefix inside engine, use oroshi.* prefix from parent

[2026-01-25 19:30:00] Story: US-002 Update sandbox generation script
Implemented: Fixed port inconsistency and verified sandbox generation works correctly
Files:
- bin/sandbox (updated port 3000 -> 3001 in 3 places)
- lib/tasks/sandbox.rake (updated port 3000 -> 3001)
Tests: PASSING (sandbox creates, routes load, model tests pass)
Learnings for future iterations:
- Sandbox runs on port 3001 to avoid conflicts with development server (port 3000)
- Routes file is GENERATED by bin/sandbox, not copied from gem
- Generated routes.rb demonstrates proper engine mounting pattern for parent apps
- Sandbox uses bin/dev which reads Procfile.dev for port configuration
- All port references must be consistent: bin/sandbox, sandbox.rake, CLAUDE.md, prompt.md

[2026-01-26 08:35:00] Story: US-003 Update test environment configuration
Implemented: Verified test environment already correctly configured for engine routes
Files:
- test/test_helper.rb (verified - uses Oroshi::Engine.routes.url_helpers)
- test/application_system_test_case.rb (verified - uses oroshi helper method)
- test/dummy/config/routes.rb (verified - properly mounts engine at /oroshi)
Tests: PASSING (controller: 26, integration: 11, system: 4 - all pass)
Learnings for future iterations:
- Test environment was already correct - previous work established the pattern
- test_helper.rb provides oroshi helper method returning Oroshi::Engine.routes.url_helpers
- Integration tests use oroshi_* helper methods (e.g., oroshi_root_path, oroshi_orders_path)
- System tests use same pattern via ApplicationSystemTestCase
- No routes_standalone_app.rb references in test directory (confirmed with grep)
- Sass deprecation warnings are from external gems (Bootstrap), not asset loading errors
- Rails deprecation warnings for resource hash arguments are cosmetic

[2026-01-26 09:45:00] Story: US-004 Verify oroshi-moab installation works
Implemented: Fixed critical engine isolation issues and verified installation works
Files Modified:
- config/routes.rb (removed Rails.application.routes.draw block - engine ONLY uses Engine.routes.draw)
- app/helpers/oroshi/application_helper.rb (NEW - moved helpers from ApplicationHelper)
- app/controllers/oroshi/application_controller.rb (added helper Oroshi::ApplicationHelper)
- test/test_helper.rb (changed to use dummy app environment)
- test/controllers/routes_test.rb (updated root route test expectation)
- test/dummy/config/cable.yml (NEW - ActionCable test config)
- test/dummy/config/storage.yml (NEW - ActiveStorage test config)
- test/dummy/db/schema.rb (copied from main app)
Parent App Changes (oroshi-moab):
- config/routes.rb (added root route for main_app.root_path to work)
Tests: PASSING (controller: 26, dashboard integration: 11 - 37 runs, 66 assertions)
Learnings for future iterations:
- Engine config/routes.rb must ONLY contain Oroshi::Engine.routes.draw - no Rails.application.routes.draw
- Non-namespaced ApplicationHelper is shadowed by parent app - use Oroshi::ApplicationHelper
- Parent apps MUST define a root route if engine views use main_app.root_path
- test_helper.rb must use test/dummy/config/environment for proper engine testing
- FactoryBot needs find_definitions called manually after changing definition_file_paths
- Engine controllers need: helper Oroshi::ApplicationHelper to access title, icon, date helpers
- Dummy app needs cable.yml with 'test: adapter: test' for ActionCable tests
- Dummy app needs storage.yml for ActiveStorage tests

[2026-01-26 10:15:00] Story: US-005 Update documentation for route pattern
Implemented: Comprehensive documentation of single route file pattern across all project docs
Files Modified:
- README.md (added Route Architecture section with examples and requirements)
- CLAUDE.md (enhanced Engine Isolation & Routing with detailed pattern documentation)
- .ralph/prompt.md (added gotchas #11 and #12 for route pattern and parent requirements)
- .ralph/REALIZATIONS.md (added Rails Engine Patterns section with Single Route File Pattern entry)
- config/routes.rb (enhanced header comment with CRITICAL warnings and references)
Tests: PASSING (controller: 26 tests, rubocop clean)
Learnings for future iterations:
- Documentation for patterns should be in MULTIPLE places: README (users), CLAUDE.md (developers), REALIZATIONS.md (future AI agents)
- config/routes.rb header comment is first place new developers look - make it comprehensive
- The single route file pattern prevents dual route file mistakes that break asset loading
- Key principle: engine uses Oroshi::Engine.routes.draw, parent uses Rails.application.routes.draw
- Route helper context table is useful: from engine vs from parent app, with/without prefix

[2026-01-26 10:30:00] Story: US-006 Create install generator
Implemented: Enhanced install generator with comprehensive documentation and new features
Files Modified:
- lib/generators/oroshi/install/install_generator.rb (comprehensive overhaul)
Features Added:
- Comprehensive header comment (60+ lines) explaining usage, prerequisites, and steps
- Method-level comments for all 11 generator steps
- --run-migrations flag to optionally run db:migrate and Solid schema loads
- add_root_route step to ensure parent app has root route for main_app.root_path
- Improved mount_engine with comment about changing mount path
- Conditional post-install instructions based on --run-migrations flag
Tests: PASSING (rubocop clean, controller tests pass)
Learnings for future iterations:
- Rails generators should have comprehensive header comments explaining all options
- Optional flags (--run-migrations) are better than forced execution for DB operations
- Generator should handle edge cases like existing files and already-mounted engines
- Step-by-step numbering in comments helps developers understand the flow
- The generator is idempotent - safe to run multiple times
