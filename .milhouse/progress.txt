# Milhouse Progress Log
Started: Fri Feb  7 13:30:00 JST 2026
---

[2026-02-07 13:35:00] Story: US-001 - Fix CSS 404 for ultimate_turbo_modal_bootstrap.css
Implemented: Removed .css extension from @import directive in application.scss
Files: app/assets/stylesheets/application.scss
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- Propshaft SCSS: @import "file.css" generates a CSS @import url() request (causes 404). Remove the .css extension to embed file contents inline.
- This is a one-line fix with high impact — eliminates persistent console 404 error.

[2026-02-07 14:57:00] Story: US-002 - Fix Bootstrap ScrollSpy import in revenue controller
Implemented: Added explicit Bootstrap ESM import in the revenue Stimulus controller so bootstrap.ScrollSpy resolves in module scope.
Files: app/javascript/controllers/oroshi/orders/revenue_controller.js, .milhouse/prd.json
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- Stimulus controllers cannot rely on Bootstrap imported in application.js; each controller using bootstrap.* must import bootstrap directly.
- The existing ScrollSpy initialization logic worked once bootstrap was in scope; this story required a minimal targeted JS change.

[2026-02-07 14:59:57] Story: US-003 - Fix order quantity inline editing (注文表 tab)
Implemented: Fixed the order edit form Stimulus submit action binding to use an explicit submit event so inline quantity updates trigger orderFormSubmit and PATCH to quantity_update via fetch.
Files: app/views/oroshi/orders/edit.html.erb, .milhouse/prd.json
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- Stimulus action bindings on forms must include explicit event syntax (submit->controller#method); omitting the event prevents handler invocation.
- The quantity input change wiring in order_number_field was already correct; the submit action string was the blocking issue for inline save.

[2026-02-07 16:23:16] Story: Fix order price inline editing (単価記載 tab)
Implemented: Updated the order sales form Stimulus wiring so price inputs use the sales-form namespace and submit through the order controller with explicit submit/change events to the price_update endpoint.
Files: app/views/oroshi/orders/dashboard/sales/_order_sales_form.html.erb, .milhouse/prd.json, .milhouse/progress.txt
Tests: PASSING
Learnings for future iterations:
- For nested Turbo-frame forms, attach both controllers on the form when targets/actions span multiple Stimulus namespaces.
- Use explicit submit->... and change->... actions to avoid brittle implicit event behavior in inline edit flows.

[2026-02-07 16:28:29] Story: US-005 - Refactor order modal to match supply modal pattern
Implemented: Added a dedicated order dialog Stimulus controller extending @stimulus-components/dialog, migrated the order modal wrapper/actions to that namespace, moved the orders turbo-frame into modal-body only, and replaced Bootstrap modal close/hide usage in dashboard handlers with native dialog.close() flow.
Files: app/javascript/controllers/oroshi/orders/order_dialog_controller.js, app/javascript/controllers/oroshi/orders/order_dashboard_controller.js, app/javascript/controllers/oroshi/orders/calendar_controller.js, app/views/oroshi/orders/modal/_order_modal.html.erb, app/views/oroshi/orders/_orders_modal_form.html.erb, app/views/oroshi/orders/modal/_calendar.html.erb, app/views/oroshi/products/_order_modal_product_form.html.erb, app/views/oroshi/product_variations/_order_modal_product_variation_form.html.erb, app/views/oroshi/product_inventories/show.html.erb, .milhouse/prd.json
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- For dialog migration, use controller-specific target attributes (data-oroshi--...-target="dialog") and add a fallback selector during transition to avoid breaking existing callers.
- Native <dialog> + @stimulus-components/dialog needs explicit close event dispatch to keep Turbo-dependent cleanup logic deterministic.

[2026-02-07 16:32:12] Story: US-006 - Improve order filters UI/UX (minimal)
Implemented: Added a visible filter reset button in the dashboard filter card wired to order-dashboard#resetOrderFilters, introduced active-filter highlighting with count badge, and made filter pill groups wrap to avoid small-screen overflow. Extended resetOrderFilters to support direct reset path navigation and form-based clear+submit behavior.
Files: app/javascript/controllers/oroshi/orders/order_dashboard_controller.js, app/views/oroshi/orders/dashboard/shared/filter_buttons/_filter_card.html.erb, app/views/oroshi/orders/dashboard/shared/filter_buttons/_filter_buttons.html.erb, app/views/oroshi/orders/dashboard/shared/filter_buttons/_filter_order_templates_form.html.erb, .milhouse/prd.json
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- For GET filter UIs rendered in Turbo frames, Turbo.visit with { frame: "orders_dashboard" } is a reliable way to reset query params without manual URL construction in JS.
- Combining flex-wrap on both the filter-card container and each nav-pills group prevents clipping when multiple filter categories are visible on narrow widths.

[2026-02-07 16:35:38] Story: US-007 - Replace legacy 牡蠣 references on supply dates page
Implemented: Updated supply date header/title-related copy to generic 原料 terminology across locale and printable guideline files, and aligned the supply date system test assertion with the new header text.
Files: config/locales/ja/oroshi/supply_dates.yml, config/locales/oroshi.ja.yml, config/locales/oroshi.hints.ja.yml, lib/printables/supply_check/header_and_footer.rb, test/system/oroshi/supply_dates/show_test.rb, .milhouse/prd.json
Tests: PASSING (617 runs, 0 failures, 0 errors)
Learnings for future iterations:
- Legacy domain terms can remain in locale hint examples and printable copy even after UI headers are updated, so run a focused keyword grep across both locale and printable files.
- Updating visible header copy usually requires updating system-test text assertions to keep end-to-end expectations aligned.
