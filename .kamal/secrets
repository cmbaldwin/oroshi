# Secrets defined here are available for reference under registry/password, env/secret, builder/secrets,
# and accessories/*/env/secret in config/deploy.yml. All secrets should be pulled from either
# password manager, ENV, or a file. DO NOT ENTER RAW CREDENTIALS HERE! This file needs to be safe for git.

# Configuration (set these as ENV vars or update the values below)
# ONEPASSWORD_ACCOUNT_ID - Your 1Password account ID
# ONEPASSWORD_VAULT - Your 1Password vault name (e.g., "Oroshi/Production")
ONEPASSWORD_ACCOUNT_ID="${ONEPASSWORD_ACCOUNT_ID}"
ONEPASSWORD_VAULT="${ONEPASSWORD_VAULT:-Oroshi/Production}"

SECRETS=$(kamal secrets fetch --adapter 1password --account ${ONEPASSWORD_ACCOUNT_ID} --from "${ONEPASSWORD_VAULT}" SECRET_KEY_BASE ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY ACTIVE_RECORD_ENCRYPTION_DETERMINISTIC_KEY ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT POSTGRES_PASSWORD CLOUDFLARE_SSL_CERT_PEM CLOUDFLARE_SSL_KEY_PEM GCLOUD_BUCKET GBUCKET_PREFIX GCLOUD_PROJECT DEVISE_KEY MAIL_SENDER RESEND_API_KEY)

# Rails
SECRET_KEY_BASE=$(kamal secrets extract SECRET_KEY_BASE ${SECRETS})
ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY=$(kamal secrets extract ACTIVE_RECORD_ENCRYPTION_PRIMARY_KEY ${SECRETS})
ACTIVE_RECORD_ENCRYPTION_DETERMINISTIC_KEY=$(kamal secrets extract ACTIVE_RECORD_ENCRYPTION_DETERMINISTIC_KEY ${SECRETS})
ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT=$(kamal secrets extract ACTIVE_RECORD_ENCRYPTION_KEY_DERIVATION_SALT ${SECRETS})

# Postgres
POSTGRES_PASSWORD=$(kamal secrets extract POSTGRES_PASSWORD ${SECRETS})

# Cloudflare SSL
CLOUDFLARE_SSL_CERT_PEM=$(kamal secrets extract CLOUDFLARE_SSL_CERT_PEM ${SECRETS})
CLOUDFLARE_SSL_KEY_PEM=$(kamal secrets extract CLOUDFLARE_SSL_KEY_PEM ${SECRETS})

# Google Cloud Storage
GCLOUD_BUCKET=$(kamal secrets extract GCLOUD_BUCKET ${SECRETS})
GCLOUD_PROJECT=$(kamal secrets extract GCLOUD_PROJECT ${SECRETS})
GBUCKET_PREFIX=$(kamal secrets extract GBUCKET_PREFIX ${SECRETS})

# Email (Resend)
RESEND_API_KEY=$(kamal secrets extract RESEND_API_KEY ${SECRETS})
MAIL_SENDER=$(kamal secrets extract MAIL_SENDER ${SECRETS})

# Devise
DEVISE_KEY=$(kamal secrets extract DEVISE_KEY ${SECRETS})

# Deployment configuration (REQUIRED - set these in your environment)
# KAMAL_HOST - Production server IP address
# KAMAL_DOMAIN - Production domain name
# AWS_ECR_REGISTRY - ECR registry URL (e.g., YOUR_ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com)
# GCS_CREDENTIALS_FILE - Path to GCS credentials JSON file
KAMAL_HOST="${KAMAL_HOST}"
KAMAL_DOMAIN="${KAMAL_DOMAIN}"
AWS_ECR_REGISTRY="${AWS_ECR_REGISTRY}"
GCS_CREDENTIALS_FILE="${GCS_CREDENTIALS_FILE:-gcs-credentials.json}"

# Get ECR password using AWS CLI (update region as needed)
AWS_ECR_REGION="${AWS_ECR_REGION:-ap-southeast-2}"
AWS_ECR_PASSWORD=$(aws ecr get-login-password --region ${AWS_ECR_REGION} --profile default)
