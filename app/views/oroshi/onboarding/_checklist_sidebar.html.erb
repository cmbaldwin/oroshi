<%# Sidebar checklist for users who skipped onboarding %>
<% progress = current_user.onboarding_progress %>
<% return unless progress&.skipped? && !progress.completed? && !progress.checklist_dismissed? %>

<div class="onboarding-checklist-sidebar bg-light border-start p-3" style="position: fixed; right: 0; top: 80px; width: 300px; max-height: calc(100vh - 100px); overflow-y: auto; z-index: 1030;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h6 class="mb-0">
      <i class="bi bi-list-check me-2"></i>
      セットアップチェックリスト
    </h6>
    <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#dismissChecklistModal">
      <i class="bi bi-x"></i>
    </button>
  </div>

  <% Oroshi::OnboardingController::STEPS.each do |phase, steps| %>
    <div class="mb-3">
      <small class="text-muted text-uppercase fw-bold">
        <%= I18n.t("onboarding.phases.#{phase}", default: phase.to_s.titleize) %>
      </small>
      <ul class="list-unstyled mt-1 mb-0">
        <% steps.each do |step| %>
          <% completed = progress.step_completed?(step) %>
          <li class="py-1">
            <% if completed %>
              <i class="bi bi-check-circle-fill text-success me-2"></i>
              <span class="text-muted"><%= I18n.t("onboarding.steps.#{step}", default: step.titleize) %></span>
            <% else %>
              <i class="bi bi-circle text-secondary me-2"></i>
              <%= link_to I18n.t("onboarding.steps.#{step}", default: step.titleize),
                          oroshi_onboarding_path(step),
                          class: 'text-decoration-none' %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mt-3 pt-3 border-top">
    <%= link_to oroshi_onboarding_index_path, class: 'btn btn-primary btn-sm w-100' do %>
      <i class="bi bi-arrow-right-circle me-1"></i>
      セットアップを続ける
    <% end %>
  </div>
</div>

<%# Dismiss confirmation modal %>
<div class="modal fade" id="dismissChecklistModal" tabindex="-1" aria-labelledby="dismissChecklistModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="dismissChecklistModalLabel">
          <i class="bi bi-exclamation-triangle text-warning me-2"></i>
          チェックリストを非表示にしますか？
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>セットアップが不完全な場合、以下の機能が制限される可能性があります：</p>
        <ul class="text-muted">
          <li>材料追跡請求書の作成</li>
          <li>注文の作成と管理</li>
          <li>配送スケジュールの設定</li>
        </ul>
        <p class="mb-0">後からダッシュボードの設定メニューから再開できます。</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
        <%= button_to '非表示にする', dismiss_checklist_oroshi_onboarding_index_path,
                      method: :post,
                      class: 'btn btn-warning',
                      data: { turbo: false } %>
      </div>
    </div>
  </div>
</div>
