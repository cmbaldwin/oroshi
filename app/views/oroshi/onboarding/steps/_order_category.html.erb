<% order_categories = Oroshi::OrderCategory.all %>

<h2 class="mb-4"><%= t('.title') %></h2>

<p class="text-muted mb-4">
  <%= t('.description') %>
</p>

<% if order_categories.any? %>
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0"><%= t('oroshi.onboarding.messages.configured_categories') %></h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm mb-0">
          <thead>
            <tr>
              <th></th>
              <th>名前</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% order_categories.each do |cat| %>
              <tr>
                <td><span class="color-circle" style="background-color: <%= cat.color %>;"></span></td>
                <td><%= cat.name %></td>
                <td class="text-end">
                  <%= button_to t('oroshi.onboarding.buttons.delete'),
                                oroshi_onboarding_path(@step, delete_order_category_id: cat.id),
                                method: :patch,
                                class: "btn btn-sm btn-outline-danger",
                                data: { turbo_confirm: t('oroshi.onboarding.confirmations.delete_category') } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% else %>
  <div class="alert alert-info mb-4">
    <i class="bi bi-info-circle me-2"></i>
    <%= t('.no_records_warning') %>
  </div>
<% end %>

<div class="card">
  <div class="card-header">
    <h5 class="mb-0"><%= t('oroshi.onboarding.messages.add_new_category') %></h5>
  </div>
  <div class="card-body">
    <%= f.fields_for :order_category do |oc| %>
      <div class="row">
        <div class="col-md-6 mb-3">
          <%= oc.label :name, '名前 *', class: 'form-label' %>
          <%= oc.text_field :name,
                           placeholder: '例: 通常、急ぎ、予約',
                           required: order_categories.empty?,
                           class: 'form-control' %>
        </div>

        <div class="col-md-6 mb-3">
          <%= oc.label :color, '識別カラー *', class: 'form-label' %>
          <%= oc.color_field :color,
                            value: '#28a745',
                            required: order_categories.empty?,
                            class: 'form-control form-control-color w-100' %>
          <div class="form-text">注文一覧での表示に使用</div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<% if order_categories.empty? %>
  <div class="alert alert-warning mt-3">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <%= t('.validation_error') %>
  </div>
<% end %>

<div class="alert alert-success mt-4">
  <i class="bi bi-check-circle me-2"></i>
  <%= t('oroshi.onboarding.messages.final_step_success') %>
</div>
